## 差分隐私基本知识
### 差分隐私定义：
若机制 M 对于任一输出集合 S 和任意邻近集 D, D′ 总有：
> Pr[ M(D) ∈ S ] ⩽ exp(ε) ⋅ Pr[ M(D′) ∈ S ] + δ

则称 M 满足 `(ε,δ)-DP`. 当 δ=0 时，称为 `ε-DP`. 其中 ε 称为隐私预算.

记号说明：

- 数据集：数据全体记作 X，其子集 D⊂X 称为数据集.
- 邻近集：只相差一条记录的一对数据集. 即 |D△D′|=1.
- 查询：映射 `f:D→R`. 全体查询记作 F.
- 查询的敏感度：

1. 局部敏感度：`LS(f)=max(D′)∥f(D)−f(D′)∥1`.
2. 全局敏感度：`GS(f) / Δf =max(D,D′)∥f(D)−f(D′)∥1`.

容易看出，局部敏感度会与数据分布有很强的关联，但全局敏感度一般较大. 故在需要使用局部敏感度时，常采用局部敏感度的平滑上界.

### 差分隐私性质
- 并行组成  
假设我们有一组隐私机制 `M = { M1， … ， Mm }` 如果每个 Mi 对整个数据集的互不相交子集提供 ϵ-DP 保证，则 M 将提供 `max {ϵ1，…，ϵm}-DP`  

- 顺序组成  
假设在数据集上依次执行一组隐私机制 `M = { M1 ， . . . ， Mm }`，并且每个 Mi 提供 ϵ-DP 保证，则 M 将提供 `(m * ϵ)-DP`

- 高级组合定理  
通常用机制来表示，这些机制是 k-fold 自适应组合的实例。k-fold 自适应组合是一系列机制 `m1 , … , mk`，  
使得： 每个机制 mi 都可以根据所有先前机制的输出来选择 `m1 , … , mi-1`（因此自适应)。   
每个机制 mi 的输入既是私有数据集，也是以前机制的所有输出。  
假设 k-fold 自适应组合 `m1 , … , mk` 中的每个机制 mi 都满足ϵ \epsilonϵ-差分隐私  
然后对于任何 δ ≥ 0 ，整个k-fold 自适应组合满足 `(ϵ′, δ′ )-DP`，其中：`ϵ′ = 2 * ϵ * sqrt(2 * k * log(1/δ′))`

### 数值性查询 
### Laplace 机制
Laplace分布：这里只考虑均值为 0 的Laplace分布. 尺度参数为 b 的Laplace分布记为 Lap(b)，
其密度函数为：`p(x) = 1/2b * exp(−|x| / b)`

Laplace机制就是给查询结果添加服从Laplace分布的噪声，即：
 `Pr[ M(D) ∈ S ] ⩽ exp(ε) ⋅ Pr[ M(D′) ∈ S ] + δ`  `M(D) = f(D) + Y`  
`Y~Lap(0, Δf / ε)` 满足 `(ε,0)-DP` 


### 高斯机制
Laplace机制提供的是严格的 `(ε,0)-DP` ，而高斯机制则提供的是松弛的 `(ε,δ)-DP` 机制。  
高斯机制是拉普拉斯机制的替代方案，不同在于加的是高斯噪声而不是拉普拉斯噪声。

理论机制：
对于任意的 ` δ ∈ （0，1）, σ > sqrt(2 * Δf**2 * log(1.25/δ)) / ϵ`,有噪声 `Y~N(0,σ**2)` 满足 `(ε,δ)-DP`  
定义： `Pr[M(D) ∈ S] ⩽ exp(ε) ⋅ Pr[M(D′) ∈ S] + δ` 其中`M(D) = f(D) + Y `   

参数  
- 高斯分布的标准差 σ，这决定了噪声的尺度
- ε 表示隐私预算，和噪声成负相关
- δ 表示松弛项，比如设置为 10^(-5) ，就表示只能容忍 10^(-5) 的概率违反严格差分隐私

### 数值性查询 
### 指数机制
指数机制整体的思想就是，当接收到一个查询之后，不是确定性的输出一个 Ri 结果，而是以一定的概率值返回结果，从而实现差分隐私。
而这个概率值则是由打分函数确定，得分高的输出概率高，得分低的输出概率低，当然分越高，表示这个数据越重要。  
打分函数：`u(D,Ri) ` D 数据集，`u(D,Ri)` 表示某一个输出结果 Ri 的得分   
u 的改变：`∆u = max(D,D′) |u(D,R) - u(D′,R)|`  
设计指数机制的出发点即为对于任意的 r，按照`exp(εu(x, r)/∆u)` 的概率选取最优解即可满足差分隐私要求：
`ln((exp(εu(D, r)/∆u))/(exp(εu(y, r)/∆u))) = ε[u(x, r) - u(y,r)]/∆u <= ε`  

因此得出了指数机制：设`随机化算法 M(x,u,R)`若以正比于`exp(εu(x, r)/ (2 * ∆u))` 的概率从输入中选择并输出r，则 算法M 是 ε-DP.
输入为`数据集 x`，μ为可用性函数`u(x,R)`，输出为一个实体对象 `r∈R`，`Δμ`为函数 `μ(x,R)` 的敏感度  

| 疾病   | 可用性, ∆u=1 | exp((ε * u(x, R))/(2∆u)) | ε=0 概率 | ε=0.1 概率 |
|:-----|:----------|:-------------------------|:-------|:---------|
| math | 50        | exp((ε * u(50,R)) / 2*1) | 0.333  | 0.628    | 
| AI   | 20        | exp((ε * u(20,R)) / 2*1) | 0.333  | 0.124    | 
| DP   | 30        | exp((ε * u(30,R)) / 2*1) | 0.333  | 0.231    | 



### 可用性评估
给数据加噪声必定会降低数据的可用性，对可用性的评估一般有以下几种：

1. 直接看噪声大小：噪声 ↓，可用性 ↑.
2. 对误差进行度量：单次查询误差为 ∥f(D)−fn(D)∥ （fn 表示加了噪音的 f）
3. (α,β)-可用性：当 F 满足
> Pr[maxf ∈ F| f(D) − fn(D)|⩽α]>1−β  
> 称 D 是 (α,β)-可用的.




